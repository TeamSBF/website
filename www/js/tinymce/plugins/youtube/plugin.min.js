(function(tiny)
{
	tiny.PluginManager.add("youtube",
		function(editor, url)
		{
            // not included inline to enable reuse
			function showDialog(e)
			{
				editor.windowManager.open({
					title: "Insert a YouTube Video",
					file: url + "/display.html",
					width: 800,
					height: 530,
					inline: 1,
					resizable: true
				},
                {
                    selectedItem: tinymce.activeEditor.selection.getNode()
                });
			}
            
            function isYouTubeImage(img)
            {
                if(img == null)
                    img = tinymce.activeEditor.selection.getNode();
                return img.nodeName === "IMG" && $(img).attr("src").indexOf("youtu") >= 0;
            }
		
			editor.addButton("youtube",{
				icon: true,
				image: url + "/img/youtube.gif",
				tooltip: "Add/Edit a YouTube Video",
				onclick: showDialog,
                onPostRender: function () {
                    var self = this;
                    editor.on("NodeChange", function (e) {
                        self.active(isYouTubeImage(e.element));
                    });
                }
            });
            
            editor.addMenuItem("youtube", {
                icon: true,
                image: url + "/img/youtube.gif",
                text: "Insert/Edit YouTube Video",
                context: 'insert',
                prependToContext: true,
                onclick: showDialog,
                onshow: function(){alert("showing");},
                onhide: function(){alert("hide");}
            });
             
             
            editor.addMenuItem("youtube", {
                icon: true,
                image: url + "/img/youtube.gif",
                text: "Insert/Edit YouTube Video",
                context: 'insert',
                prependToContext: true,
                onclick: showDialog,
                onshow: function(){alert("showing");},
                onhide: function(){alert("hide");}
            });
		});
}(tinymce));